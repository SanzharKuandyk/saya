import {
    VerticalBox,
    HorizontalBox,
    ScrollView,
    Button,
    CheckBox,
    LineEdit,
    SpinBox,
    ComboBox,
    TabWidget
} from "std-widgets.slint";

export component ConfigPanel {
    callback config-updated(string, string);
    callback close-panel();

    // UI Config Properties
    in-out property <int> max-text-lines: 3;

    // OCR Config Properties
    in-out property <bool> ocr-enabled: true;
    in-out property <string> ocr-language: "ja";
    in-out property <int> ocr-region-x: 100;
    in-out property <int> ocr-region-y: 100;
    in-out property <int> ocr-region-width: 600;
    in-out property <int> ocr-region-height: 400;
    in-out property <string> ocr-target-window: "";

    // Anki Config Properties
    in-out property <bool> anki-enabled: true;
    in-out property <string> anki-url: "http://localhost:8765";
    in-out property <string> anki-deck: "Japanese";
    in-out property <string> anki-model: "Basic";

    // Dictionary Config Properties
    in-out property <bool> dictionary-enabled: true;
    in-out property <string> dictionary-paths: "";

    // Translator Config Properties
    in-out property <bool> translator-enabled: true;
    in-out property <string> translator-provider: "google";
    in-out property <string> translator-from-lang: "ja";
    in-out property <string> translator-to-lang: "en";
    in-out property <string> translator-api-key: "";
    in-out property <string> translator-api-url: "";

    // Global Config Properties
    in-out property <int> watchdog-timeout: 10000;
    in-out property <int> delta-time: 100;
    in-out property <int> timeout-seconds: 30;
    in-out property <bool> listen-to-ws: false;
    in-out property <string> ws-url: "ws://localhost:8080";

    VerticalBox {
        padding: 24px;
        spacing: 20px;

        // Modern Header
        HorizontalBox {
            spacing: 16px;
            height: 48px;

            Rectangle {
                width: 4px;
                background: #00ff88;
                border-radius: 2px;
            }

            Text {
                text: "Settings";
                font-size: 28px;
                font-weight: 700;
                color: #ffffff;
                horizontal-stretch: 1;
                vertical-alignment: center;
            }

            Button {
                text: "Close";
                clicked => { root.close-panel(); }
            }
        }

        // Configuration Tabs
        TabWidget {
            vertical-stretch: 1;

            Tab {
                title: "Interface";

                ScrollView {
                    VerticalBox {
                        padding: 24px;
                        spacing: 20px;

                        // Section: Display
                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "Display Options";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Max text lines:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 200px;
                                        }
                                        SpinBox {
                                            value: root.max-text-lines;
                                            minimum: 1;
                                            maximum: 10;
                                            edited => {
                                                root.config-updated("ui.max_text_lines", self.value);
                                                root.max-text-lines = self.value;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            Tab {
                title: "OCR";

                ScrollView {
                    VerticalBox {
                        padding: 24px;
                        spacing: 20px;

                        // Section: OCR Settings
                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "OCR Configuration";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    CheckBox {
                                        text: "Enable OCR";
                                        checked: root.ocr-enabled;
                                        toggled => {
                                            root.config-updated("ocr.enabled", self.checked ? "true" : "false");
                                            root.ocr-enabled = self.checked;
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Language:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 120px;
                                        }
                                        ComboBox {
                                            model: ["ja", "en", "zh"];
                                            current-index: root.ocr-language == "ja" ? 0 : root.ocr-language == "en" ? 1 : 2;
                                            selected(text) => {
                                                let lang = text == "Japanese" ? "ja" : text == "English" ? "en" : "zh";
                                                root.config-updated("ocr.language", lang);
                                                root.ocr-language = lang;
                                            }
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Target Window:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 120px;
                                        }
                                        LineEdit {
                                            text: root.ocr-target-window;
                                            placeholder-text: "Optional window title";
                                            edited => {
                                                root.config-updated("ocr.target_window", self.text);
                                                root.ocr-target-window = self.text;
                                            }
                                        }
                                    }
                                }
                            }
                        }

                        // Section: Capture Region
                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "Capture Region";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    HorizontalBox {
                                        spacing: 12px;

                                        VerticalBox {
                                            spacing: 8px;
                                            Text {
                                                text: "X:";
                                                font-size: 12px;
                                                color: #808080;
                                            }
                                            SpinBox {
                                                value: root.ocr-region-x;
                                                minimum: 0;
                                                maximum: 5000;
                                                edited => {
                                                    root.config-updated("ocr.capture_region.x", self.value);
                                                    root.ocr-region-x = self.value;
                                                }
                                            }
                                        }

                                        VerticalBox {
                                            spacing: 8px;
                                            Text {
                                                text: "Y:";
                                                font-size: 12px;
                                                color: #808080;
                                            }
                                            SpinBox {
                                                value: root.ocr-region-y;
                                                minimum: 0;
                                                maximum: 5000;
                                                edited => {
                                                    root.config-updated("ocr.capture_region.y", self.value);
                                                    root.ocr-region-y = self.value;
                                                }
                                            }
                                        }

                                        VerticalBox {
                                            spacing: 8px;
                                            Text {
                                                text: "Width:";
                                                font-size: 12px;
                                                color: #808080;
                                            }
                                            SpinBox {
                                                value: root.ocr-region-width;
                                                minimum: 100;
                                                maximum: 2000;
                                                edited => {
                                                    root.config-updated("ocr.capture_region.width", self.value);
                                                    root.ocr-region-width = self.value;
                                                }
                                            }
                                        }

                                        VerticalBox {
                                            spacing: 8px;
                                            Text {
                                                text: "Height:";
                                                font-size: 12px;
                                                color: #808080;
                                            }
                                            SpinBox {
                                                value: root.ocr-region-height;
                                                minimum: 100;
                                                maximum: 2000;
                                                edited => {
                                                    root.config-updated("ocr.capture_region.height", self.value);
                                                    root.ocr-region-height = self.value;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            Tab {
                title: "Dictionary";

                ScrollView {
                    VerticalBox {
                        padding: 24px;
                        spacing: 20px;

                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "Dictionary Settings";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    CheckBox {
                                        text: "Enable Dictionary";
                                        checked: root.dictionary-enabled;
                                        toggled => {
                                            root.config-updated("dictionary.enabled", self.checked ? "true" : "false");
                                            root.dictionary-enabled = self.checked;
                                        }
                                    }

                                    VerticalBox {
                                        spacing: 8px;

                                        Text {
                                            text: "Additional Dictionary Paths";
                                            color: #b0b0b0;
                                            font-size: 12px;
                                        }
                                        LineEdit {
                                            text: root.dictionary-paths;
                                            placeholder-text: "Comma-separated paths";
                                            edited => {
                                                root.config-updated("dictionary.additional_paths", self.text);
                                                root.dictionary-paths = self.text;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            Tab {
                title: "Anki";

                ScrollView {
                    VerticalBox {
                        padding: 24px;
                        spacing: 20px;

                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "Anki Integration";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    CheckBox {
                                        text: "Enable Anki Integration";
                                        checked: root.anki-enabled;
                                        toggled => {
                                            root.config-updated("anki.enabled", self.checked ? "true" : "false");
                                            root.anki-enabled = self.checked;
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "AnkiConnect URL:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 140px;
                                        }
                                        LineEdit {
                                            text: root.anki-url;
                                            edited => {
                                                root.config-updated("anki.url", self.text);
                                                root.anki-url = self.text;
                                            }
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Default Deck:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 140px;
                                        }
                                        LineEdit {
                                            text: root.anki-deck;
                                            edited => {
                                                root.config-updated("anki.deck", self.text);
                                                root.anki-deck = self.text;
                                            }
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Default Model:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 140px;
                                        }
                                        LineEdit {
                                            text: root.anki-model;
                                            edited => {
                                                root.config-updated("anki.model", self.text);
                                                root.anki-model = self.text;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            Tab {
                title: "Advanced";

                ScrollView {
                    VerticalBox {
                        padding: 24px;
                        spacing: 20px;

                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "Advanced Settings";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Watchdog Timeout (ms):";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 180px;
                                        }
                                        SpinBox {
                                            value: root.watchdog-timeout;
                                            minimum: 1000;
                                            maximum: 60000;
                                            edited => {
                                                root.config-updated("watchdog_timeout_ms", self.value);
                                                root.watchdog-timeout = self.value;
                                            }
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "Delta Time (ms):";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 180px;
                                        }
                                        SpinBox {
                                            value: root.delta-time;
                                            minimum: 10;
                                            maximum: 1000;
                                            edited => {
                                                root.config-updated("delta_time", self.value);
                                                root.delta-time = self.value;
                                            }
                                        }
                                    }
                                }
                            }
                        }

                        VerticalBox {
                            spacing: 12px;

                            Text {
                                text: "WebSocket";
                                font-size: 16px;
                                font-weight: 600;
                                color: #00ff88;
                            }

                            Rectangle {
                                background: #1a1a1aDD;
                                border-radius: 12px;
                                border-width: 1px;
                                border-color: #333333;

                                VerticalBox {
                                    padding: 16px;
                                    spacing: 16px;

                                    CheckBox {
                                        text: "Listen to WebSocket";
                                        checked: root.listen-to-ws;
                                        toggled => {
                                            root.config-updated("listen_to_ws", self.checked ? "true" : "false");
                                            root.listen-to-ws = self.checked;
                                        }
                                    }

                                    HorizontalBox {
                                        spacing: 16px;

                                        Text {
                                            text: "WebSocket URL:";
                                            vertical-alignment: center;
                                            color: #b0b0b0;
                                            width: 120px;
                                        }
                                        LineEdit {
                                            text: root.ws-url;
                                            edited => {
                                                root.config-updated("ws_url", self.text);
                                                root.ws-url = self.text;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
