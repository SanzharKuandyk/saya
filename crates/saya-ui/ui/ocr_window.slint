import { VerticalBox, HorizontalBox, Button, ComboBox } from "std-widgets.slint";

export component OcrWindow inherits Window {
    title: "OCR Capture";
    always-on-top: true;

    callback capture-clicked();
    callback refresh-windows();
    callback window-selected(int);

    in-out property <string> status: "Ready";
    in-out property <bool> is-capturing: false;
    in-out property <[string]> window-list: [];
    in-out property <int> selected-window-index: -1;

    preferred-width: 400px;
    preferred-height: 340px;

    background: #1e1e1e66;

    VerticalBox {
        padding: 8px;
        spacing: 8px;

        // Window selector
        Rectangle {
            height: 50px;
            background: #2d2d2ddd;
            border-radius: 4px;

            HorizontalBox {
                padding: 10px;
                spacing: 10px;

                Text {
                    text: "Window:";
                    color: #ffffff;
                    vertical-alignment: center;
                    font-size: 14px;
                }

                Rectangle {
                    background: #3d3d3d;
                    border-radius: 4px;
                    horizontal-stretch: 1;

                    ComboBox {
                        width: 100%;
                        height: 100%;
                        model: window-list;
                        current-index <=> selected-window-index;
                        selected(value) => {
                            root.window-selected(self.current-index);
                        }
                    }
                }

                Button {
                    text: "Refresh";
                    clicked => { root.refresh-windows(); }
                }
            }
        }

        // Capture region indicator
        Rectangle {
            background: #00ff0022;
            border-color: #00ff00;
            border-width: 3px;
            border-radius: 4px;

            VerticalBox {
                alignment: center;

                Text {
                    text: selected-window-index >= 0 ? "Window capture mode" : "Full screen mode";
                    color: #00ff00;
                    font-size: 16px;
                    font-weight: 700;
                }

                Text {
                    text: "Press F9 or click Capture";
                    color: #ffffff;
                    font-size: 14px;
                }
            }
        }

        // Control bar
        Rectangle {
            height: 50px;
            background: #2d2d2dcc;
            border-radius: 4px;

            HorizontalBox {
                padding: 8px;
                spacing: 12px;

                Button {
                    text: is-capturing ? "Capturing..." : "Capture";
                    enabled: !is-capturing;
                    clicked => {
                        root.capture-clicked();
                    }
                }

                Text {
                    text: status;
                    color: is-capturing ? #ffaa00 : #00ff00;
                    vertical-alignment: center;
                    font-size: 12px;
                    font-weight: 600;
                }
            }
        }
    }
}
