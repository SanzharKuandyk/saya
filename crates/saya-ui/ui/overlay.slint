import { VerticalBox, HorizontalBox, ScrollView, Button } from "std-widgets.slint";

export struct DictResult {
    term: string,
    reading: string,
    definition: string,
    frequency: string,
    pitch_accent: string,
    jlpt_level: string,
    conjugation: string,
}

export component OverlayWindow inherits Window {
    title: "Saya";
    always-on-top: true;

    in-out property <[DictResult]> results: [];
    in-out property <string> hooked-text: "";
    in-out property <string> text-source: "";
    callback add-to-anki(int);

    preferred-width: 600px;
    preferred-height: 500px;

    background: #1e1e1ee6;

    VerticalBox {
        padding: 16px;
        spacing: 12px;

        // Top block: hooked text display
        if hooked-text != "": Rectangle {
            background: #2a2a2a;
            border-radius: 8px;
            min-height: 60px;
            max-height: 120px;

            VerticalBox {
                padding: 12px;
                spacing: 6px;

                HorizontalBox {
                    spacing: 8px;

                    Rectangle {
                        width: 8px;
                        height: 8px;
                        border-radius: 4px;
                        background: text-source == "OCR" ? #ff6b6b :
                                   text-source == "Clipboard" ? #4ecdc4 :
                                   text-source == "WebSocket" ? #a29bfe :
                                   #95a5a6;
                    }

                    Text {
                        text: text-source;
                        font-size: 11px;
                        color: #808080;
                        font-weight: 600;
                    }
                }

                ScrollView {
                    max-height: 80px;

                    Text {
                        text: hooked-text;
                        font-size: 18px;
                        color: #ffffff;
                        wrap: word-wrap;
                    }
                }
            }
        }

        // Bottom block: dictionary results
        ScrollView {
            VerticalBox {
                spacing: 8px;

                for result[idx] in results: Rectangle {
                    background: #2d2d2d;
                    border-radius: 8px;

                    VerticalBox {
                        padding: 12px;
                        spacing: 6px;

                        HorizontalBox {
                            Text {
                                text: result.term;
                                font-size: 20px;
                                color: #ffffff;
                                font-weight: 700;
                            }

                            Button {
                                text: "+ Anki";
                                clicked => {
                                    root.add-to-anki(idx);
                                }
                            }
                        }

                        Text {
                            text: result.reading;
                            font-size: 14px;
                            color: #a0a0a0;
                        }

                        // Metadata row (frequency, pitch, JLPT)
                        if result.frequency != "" || result.pitch_accent != "" || result.jlpt_level != "": HorizontalBox {
                            spacing: 8px;

                            if result.frequency != "": Text {
                                text: result.frequency;
                                font-size: 12px;
                                color: #ffd700;
                            }

                            if result.pitch_accent != "": Text {
                                text: result.pitch_accent;
                                font-size: 12px;
                                color: #87ceeb;
                            }

                            if result.jlpt_level != "": Text {
                                text: result.jlpt_level;
                                font-size: 12px;
                                color: #98fb98;
                            }
                        }

                        // Conjugation info
                        if result.conjugation != "": Text {
                            text: result.conjugation;
                            font-size: 11px;
                            color: #b0b0b0;
                            font-italic: true;
                        }

                        Text {
                            text: result.definition;
                            font-size: 14px;
                            color: #e0e0e0;
                            wrap: word-wrap;
                        }
                    }
                }
            }
        }
    }
}
